
> https://www.oo2ee.com/?p=152  
> [MySQL 可重复读隔离级别，完全解决幻读了吗？](https://xiaolincoding.com/mysql/transaction/phantom.html)

`MVCC`只能解决`快照读`下的幻读，`当前读`的幻读问题依然需要借助next-key锁来解决幻读。

# 什么是幻读？

`幻读`是指同一个事务在相同查询条件下前后读取到的数据量不一致。

`不可重复读`是指同一个事务在相同查询条件下读取到的数据不一致。

`不可重复读`和`幻读`的最大区别在于，`不可重复读`针对的是update/delete修改了查询的数据，但是`幻读`针对的是insert，插入了新的数据，之前查询的数据没有变，但是会多出来数据。

# 快照读是如何避免幻读的？

可重复读隔离级是由 MVCC（多版本并发控制）实现的，实现的方式是开始事务后（执行 begin 语句后），在执行第一个查询语句后，会创建一个 Read View，后续的查询语句利用这个 Read View，通过这个 Read View 就可以在 undo log 版本链找到事务开始时的数据，所以事务过程中每次查询的数据都是一样的，即使中途有其他事务插入了新纪录，是查询不出来这条数据的，所以就很好了避免幻读问题。

做个实验，数据库表 t_stu 如下，其中 id 为主键。



然后在可重复读隔离级别下，有两个事务的执行顺序如下：


